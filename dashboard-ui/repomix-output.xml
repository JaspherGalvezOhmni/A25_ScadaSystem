This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  Ohmni Logo.png
  Ohmni_Logo_RGB_Blue_WhiteBG.svg
  Ohmni_Logo_RGB_Blue.svg
  ohmni_pty_ltd_logo.svg
  vite.svg
src/
  assets/
    react.svg
  components/
    CommandsSidebar.jsx
    FlywheelVisual.jsx
    HealthStatus.jsx
    PensSidebar.jsx
    ProtectedRoute.jsx
    StreamingChart.jsx
  constants/
    index.js
  context/
    AuthContext.jsx
  pages/
    EngineeringPage.jsx
    HomePage.jsx
    LoginPage.jsx
    OperationalDetailsPage.jsx
  api.js
  App.css
  App.jsx
  index.css
  main.jsx
.gitignore
eslint.config.js
index.html
package.json
README.md
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/Ohmni_Logo_RGB_Blue_WhiteBG.svg">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 1070 230" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g>
        <path d="M73.96,83.92L73.96,219.11C73.96,223.19 68.86,225.18 65.97,222.23L1.28,156.2C0.46,155.36 0,154.24 0,153.08L0,83.92C0,81.42 2.08,79.4 4.64,79.4L69.33,79.4C71.89,79.4 73.97,81.42 73.97,83.92" style="fill:rgb(30,240,240);fill-rule:nonzero;"/>
        <path d="M89.31,155.19L198.63,155.19C202.85,155.19 204.88,160.38 201.78,163.26L137.87,222.59C137.01,223.38 135.89,223.83 134.72,223.83L89.31,223.83C86.75,223.83 84.67,221.75 84.67,219.18L84.67,159.85C84.67,157.28 86.74,155.2 89.31,155.2" style="fill:rgb(30,240,240);fill-rule:nonzero;"/>
        <path d="M296.6,223.82L165.21,223.82C160.99,223.82 158.96,218.63 162.06,215.75L225.97,156.42C226.83,155.62 227.95,155.18 229.12,155.18L296.6,155.18C299.16,155.18 301.24,157.26 301.24,159.83L301.24,219.16C301.24,221.73 299.17,223.81 296.6,223.81" style="fill:rgb(30,240,240);fill-rule:nonzero;"/>
        <path d="M227.33,140.06L227.33,4.91C227.33,0.83 232.43,-1.16 235.32,1.79L300.01,67.8C300.83,68.64 301.29,69.76 301.29,70.92L301.29,140.06C301.29,142.56 299.21,144.58 296.65,144.58L231.96,144.58C229.4,144.58 227.32,142.56 227.32,140.06" style="fill:rgb(30,240,240);fill-rule:nonzero;"/>
        <path d="M211.93,68.63L102.61,68.63C98.39,68.63 96.36,63.44 99.46,60.56L163.37,1.24C164.23,0.44 165.35,0 166.52,0L211.93,0C214.49,0 216.57,2.08 216.57,4.65L216.57,63.98C216.57,66.55 214.5,68.63 211.93,68.63" style="fill:rgb(30,240,240);fill-rule:nonzero;"/>
        <path d="M4.64,0L136.03,0C140.25,0 142.28,5.19 139.18,8.07L75.27,67.4C74.41,68.2 73.29,68.64 72.12,68.64L4.64,68.64C2.08,68.63 0,66.55 0,63.98L0,4.65C0,2.08 2.08,0 4.64,0" style="fill:rgb(30,240,240);fill-rule:nonzero;"/>
    </g>
    <g>
        <path d="M430.75,203.19C467.33,203.19 488.54,176.86 488.54,133.25C488.54,89.64 467.33,62.24 430.75,62.24C394.17,62.24 373.23,88.83 373.23,133.25C373.23,177.67 394.44,203.19 430.75,203.19M430.75,229.51C375.61,229.51 339.56,190.42 339.56,132.98C339.56,75.54 375.35,35.91 430.75,35.91C486.15,35.91 521.94,73.14 521.94,133.24C521.94,193.34 485.62,229.51 430.75,229.51" style="fill:white;fill-rule:nonzero;"/>
        <path d="M604.39,110.37C588.75,110.37 573.9,122.87 569.4,146.27L570.2,223.66C570.2,224.73 569.14,225.79 568.08,225.79L540.51,225.79C539.45,225.79 538.39,224.73 538.39,223.66L539.45,131.91L538.39,41.76C538.39,40.7 539.45,39.63 540.51,39.63L568.08,39.63C569.14,39.63 570.2,40.7 570.2,41.76L569.67,107.18C578.68,94.15 593,85.64 612.62,85.64C642.31,85.64 660.6,103.72 660.07,143.61L660.07,172.06L660.6,223.65C660.6,224.72 659.54,225.78 658.48,225.78L630.11,225.78C629.05,225.78 627.99,224.72 627.99,223.65L628.79,172.59L628.52,140.15C628.52,119.41 617.92,110.36 604.4,110.36" style="fill:white;fill-rule:nonzero;"/>
        <path d="M711.49,174.73L712.29,223.66C712.29,224.72 711.23,225.79 710.17,225.79L681.28,225.79C680.22,225.79 679.16,224.73 679.16,223.66L679.96,174.73L679.69,90.96C679.69,89.9 680.75,88.83 681.81,88.83L708.58,88.83C709.64,88.83 710.7,89.89 710.7,90.96L709.9,108.78C718.92,94.95 731.64,85.64 750.72,85.64C769.8,85.64 783.59,94.15 789.95,112.77C800.82,93.09 814.34,85.64 832.1,85.64C859.14,85.64 875.05,102.4 875.05,139.36L875.05,174.73L875.84,223.66C875.84,224.72 874.78,225.79 873.72,225.79L845.35,225.79C844.29,225.79 843.23,224.73 843.23,223.66L843.76,174.73L843.76,140.16C843.76,119.42 835.28,110.64 821.76,110.64C809.56,110.64 797.64,123.4 793.66,146.54L793.66,174.73L794.19,223.66C794.19,224.72 793.13,225.79 792.07,225.79L763.7,225.79C762.64,225.79 761.58,224.73 761.58,223.66L762.38,174.73L762.38,140.16C762.38,119.42 753.9,110.64 740.38,110.64C726.86,110.64 714.14,125.53 711.48,152.66L711.48,174.73L711.49,174.73Z" style="fill:white;fill-rule:nonzero;"/>
        <path d="M896.26,225.79C895.2,225.79 894.14,224.73 894.14,223.66L894.94,161.43L894.67,90.96C894.67,89.9 895.73,88.83 896.79,88.83L923.56,88.83C924.62,88.83 925.68,89.89 925.68,90.96L924.89,108.78C933.64,96.01 949.28,85.64 969.69,85.64C998.06,85.64 1016.35,104.79 1016.35,139.36L1016.35,167.55L1016.88,223.66C1016.88,224.73 1015.82,225.79 1014.76,225.79L986.66,225.79C985.6,225.79 984.54,224.73 984.54,223.66L985.07,167.55L985.07,140.16C985.07,120.75 974.73,110.64 960.15,110.64C944.24,110.64 929.13,124.2 926.48,152.66L926.48,167.55L927.01,223.66C927.01,224.73 925.95,225.79 924.89,225.79L896.26,225.79Z" style="fill:white;fill-rule:nonzero;"/>
        <path d="M1038.61,225.79C1037.55,225.79 1036.49,224.73 1036.49,223.66L1037.02,156.38L1036.49,90.96C1036.49,89.9 1037.55,88.83 1038.61,88.83L1066.98,88.83C1068.04,88.83 1069.1,89.89 1069.1,90.96L1068.3,156.38L1069.1,223.66C1069.1,224.73 1068.04,225.79 1066.98,225.79L1038.61,225.79Z" style="fill:white;fill-rule:nonzero;"/>
        <path d="M1038.64,78.07C1037.57,78.07 1036.5,76.97 1036.5,75.88L1036.5,47.67C1036.5,46.58 1037.57,45.48 1038.64,45.48L1066.96,45.48C1068.03,45.48 1069.1,46.58 1069.1,47.67L1069.1,75.88C1069.1,76.97 1068.03,78.07 1066.96,78.07L1038.64,78.07Z" style="fill:rgb(30,240,240);fill-rule:nonzero;"/>
    </g>
</svg>
</file>

<file path="public/Ohmni_Logo_RGB_Blue.svg">
<?xml version="1.0" encoding="UTF-8"?>
<svg id="Logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1069.1 229.51">
  <defs>
    <style>
      .cls-1 {
        fill: #1ef0f0;
      }

      .cls-1, .cls-2 {
        stroke-width: 0px;
      }

      .cls-2 {
        fill: #231f20;
      }
    </style>
  </defs>
  <g>
    <path class="cls-1" d="M73.96,83.92v135.19c0,4.08-5.1,6.07-7.99,3.12L1.28,156.2c-.82-.84-1.28-1.96-1.28-3.12v-69.16c0-2.5,2.08-4.52,4.64-4.52h64.69c2.56,0,4.64,2.02,4.64,4.52"/>
    <path class="cls-1" d="M89.31,155.19h109.32c4.22,0,6.25,5.19,3.15,8.07l-63.91,59.33c-.86.79-1.98,1.24-3.15,1.24h-45.41c-2.56,0-4.64-2.08-4.64-4.65v-59.33c0-2.57,2.07-4.65,4.64-4.65"/>
    <path class="cls-1" d="M296.6,223.82h-131.39c-4.22,0-6.25-5.19-3.15-8.07l63.91-59.33c.86-.8,1.98-1.24,3.15-1.24h67.48c2.56,0,4.64,2.08,4.64,4.65v59.33c0,2.57-2.07,4.65-4.64,4.65"/>
    <path class="cls-1" d="M227.33,140.06V4.91c0-4.08,5.1-6.07,7.99-3.12l64.69,66.01c.82.84,1.28,1.96,1.28,3.12v69.14c0,2.5-2.08,4.52-4.64,4.52h-64.69c-2.56,0-4.64-2.02-4.64-4.52"/>
    <path class="cls-1" d="M211.93,68.63h-109.32c-4.22,0-6.25-5.19-3.15-8.07L163.37,1.24c.86-.8,1.98-1.24,3.15-1.24h45.41c2.56,0,4.64,2.08,4.64,4.65v59.33c0,2.57-2.07,4.65-4.64,4.65"/>
    <path class="cls-1" d="M4.64,0h131.39c4.22,0,6.25,5.19,3.15,8.07l-63.91,59.33c-.86.8-1.98,1.24-3.15,1.24H4.64C2.08,68.63,0,66.55,0,63.98V4.65C0,2.08,2.08,0,4.64,0"/>
  </g>
  <g>
    <path class="cls-2" d="M430.75,203.19c36.58,0,57.79-26.33,57.79-69.94s-21.21-71.01-57.79-71.01-57.52,26.59-57.52,71.01,21.21,69.94,57.52,69.94M430.75,229.51c-55.14,0-91.19-39.09-91.19-96.53s35.79-97.07,91.19-97.07,91.19,37.23,91.19,97.33-36.32,96.27-91.19,96.27"/>
    <path class="cls-2" d="M604.39,110.37c-15.64,0-30.49,12.5-34.99,35.9l.8,77.39c0,1.07-1.06,2.13-2.12,2.13h-27.57c-1.06,0-2.12-1.06-2.12-2.13l1.06-91.75-1.06-90.15c0-1.06,1.06-2.13,2.12-2.13h27.57c1.06,0,2.12,1.07,2.12,2.13l-.53,65.42c9.01-13.03,23.33-21.54,42.95-21.54,29.69,0,47.98,18.08,47.45,57.97v28.45l.53,51.59c0,1.07-1.06,2.13-2.12,2.13h-28.37c-1.06,0-2.12-1.06-2.12-2.13l.8-51.06-.27-32.44c0-20.74-10.6-29.79-24.12-29.79"/>
    <path class="cls-2" d="M711.49,174.73l.8,48.93c0,1.06-1.06,2.13-2.12,2.13h-28.89c-1.06,0-2.12-1.06-2.12-2.13l.8-48.93-.27-83.77c0-1.06,1.06-2.13,2.12-2.13h26.77c1.06,0,2.12,1.06,2.12,2.13l-.8,17.82c9.02-13.83,21.74-23.14,40.82-23.14s32.87,8.51,39.23,27.13c10.87-19.68,24.39-27.13,42.15-27.13,27.04,0,42.95,16.76,42.95,53.72v35.37l.79,48.93c0,1.06-1.06,2.13-2.12,2.13h-28.37c-1.06,0-2.12-1.06-2.12-2.13l.53-48.93v-34.57c0-20.74-8.48-29.52-22-29.52-12.2,0-24.12,12.76-28.1,35.9v28.19l.53,48.93c0,1.06-1.06,2.13-2.12,2.13h-28.37c-1.06,0-2.12-1.06-2.12-2.13l.8-48.93v-34.57c0-20.74-8.48-29.52-22-29.52s-26.24,14.89-28.9,42.02v22.07Z"/>
    <path class="cls-2" d="M896.26,225.79c-1.06,0-2.12-1.06-2.12-2.13l.8-62.23-.27-70.47c0-1.06,1.06-2.13,2.12-2.13h26.77c1.06,0,2.12,1.06,2.12,2.13l-.79,17.82c8.75-12.77,24.39-23.14,44.8-23.14,28.37,0,46.66,19.15,46.66,53.72v28.19l.53,56.11c0,1.07-1.06,2.13-2.12,2.13h-28.1c-1.06,0-2.12-1.06-2.12-2.13l.53-56.11v-27.39c0-19.41-10.34-29.52-24.92-29.52-15.91,0-31.02,13.56-33.67,42.02v14.89l.53,56.11c0,1.07-1.06,2.13-2.12,2.13h-28.63Z"/>
    <path class="cls-2" d="M1038.61,225.79c-1.06,0-2.12-1.06-2.12-2.13l.53-67.28-.53-65.42c0-1.06,1.06-2.13,2.12-2.13h28.37c1.06,0,2.12,1.06,2.12,2.13l-.8,65.42.8,67.28c0,1.07-1.06,2.13-2.12,2.13h-28.37Z"/>
    <path class="cls-1" d="M1038.64,78.07c-1.07,0-2.14-1.1-2.14-2.19v-28.21c0-1.09,1.07-2.19,2.14-2.19h28.32c1.07,0,2.14,1.1,2.14,2.19v28.21c0,1.09-1.07,2.19-2.14,2.19h-28.32Z"/>
  </g>
</svg>
</file>

<file path="public/ohmni_pty_ltd_logo.svg">
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="200.000000pt" height="200.000000pt" viewBox="0 0 200.000000 200.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,200.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M0 1000 l0 -1000 1000 0 1000 0 0 1000 0 1000 -1000 0 -1000 0 0
-1000z m948 489 c2 -10 -54 -68 -144 -152 l-148 -137 -168 0 -168 0 0 149 c0
110 3 151 13 154 6 3 147 4 312 3 265 -1 300 -3 303 -17z m341 8 c8 -10 11
-57 9 -153 l-3 -139 -259 -3 c-161 -1 -263 1 -270 8 -10 10 -14 7 180 186
l119 110 106 3 c82 1 108 -1 118 -12z m239 -150 l153 -153 -3 -169 -3 -170
-160 0 -160 0 -3 323 c-2 256 0 322 10 322 8 0 82 -69 166 -153z m-880 -525
c2 -304 1 -323 -15 -320 -10 2 -84 71 -165 154 l-148 151 0 166 c0 123 3 167
13 171 6 2 80 4 162 3 l150 -2 3 -323z m586 -31 c8 -12 -10 -31 -164 -173
l-135 -124 -97 -3 c-143 -3 -138 -8 -138 158 0 76 3 141 7 144 10 11 521 8
527 -2z m446 -141 c0 -82 -3 -150 -7 -150 -5 0 -145 0 -313 -1 -260 -1 -305 1
-308 14 -2 8 61 74 144 151 l147 136 169 0 168 0 0 -150z"/>
</g>
</svg>
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/CommandsSidebar.jsx">
import apiClient from '../api';
import { useAuth } from '../context/AuthContext'; // Import the auth hook to check token

const SETPOINT_TAG = 'Test_OutputVal1';

function CommandsSidebar({ setpoints }) {
  const { token } = useAuth(); // Get the current token status

  const handleSetpointCommand = async (value) => {
    // SECURITY FIX: If there is no token, prevent the command from running immediately.
    if (!token) {
        alert("Action Restricted: Please log in to send control commands.");
        return;
    }
    
    const numericValue = parseFloat(value);
    if (isNaN(numericValue)) {
      alert("Setpoint value is not a valid number.");
      return;
    }
    
    try {
      await apiClient.post('/api/write-tag', { 
        tag_name: SETPOINT_TAG, 
        value: numericValue 
      });
      alert(`Command sent: Set ${SETPOINT_TAG} to ${numericValue}`);
    } catch (error) {
      console.error(`Error writing to ${SETPOINT_TAG}:`, error);
      alert(`Failed to send command. Server may require re-login.`);
    }
  };

  // The component is DISABLED if setpoints haven't loaded OR if the user is logged out
  const isDisabled = !setpoints || Object.keys(setpoints).length === 0 || !token;

  return (
    <div className="sidebar commands-sidebar">
      <h2>Commands</h2>
      <button onClick={() => handleSetpointCommand(setpoints.charge)} disabled={isDisabled}>Charge</button>
      <button onClick={() => handleSetpointCommand(setpoints.discharge)} disabled={isDisabled}>Discharge</button>
      <button onClick={() => handleSetpointCommand(setpoints.shutdown)} disabled={isDisabled}>Shutdown</button>
      <button onClick={() => handleSetpointCommand(setpoints.idle)} disabled={isDisabled}>Set Idle</button>
    </div>
  );
}

export default CommandsSidebar;
</file>

<file path="src/components/FlywheelVisual.jsx">
import React from 'react';

function FlywheelVisual({ percentage, status }) {
  // Determine animation class based on status
  let animationClass = '';
  if (status === 'Charging') animationClass = 'spinning-charge';
  else if (status === 'Discharging') animationClass = 'spinning-discharge';

  // Determine the correct arrow direction
  const arrowDirection = status === 'Charging' ? '↓' : (status === 'Discharging' ? '↑' : '-');
  const arrowColor = status === 'Charging' ? '#2ecc71' : (status === 'Discharging' ? '#e74c3c' : '#555');

  return (
    <div className="flywheel-container">
      <div className="grid-visual">Grid</div>
      <div className="ac-network-visual">AC Power Network</div>
      
      <div className="power-flow-arrow" style={{ color: arrowColor }}>
        {arrowDirection}
      </div>
      
      {/* The Visual Circle */}
      <div className={`flywheel-visual ${animationClass}`}>
        {/* The rotating gradient fill */}
        <div className="flywheel-fill"></div>
        
        {/* The Text Overlay */}
        <div className="flywheel-text">
          <div>{status}</div>
          <div style={{fontSize: '0.8em', color: '#a0a0a0'}}>{percentage?.toFixed(0) || 0}% Speed</div>
        </div>
      </div>
    </div>
  );
}

export default FlywheelVisual;
</file>

<file path="src/components/HealthStatus.jsx">
function HealthStatus({ title, value, isHealthy, healthyText = "OK", unhealthyText = "FAULT" }) {
  const finalIsHealthy = isHealthy !== undefined ? isHealthy : value;
  let statusClass;
  let displayText;

  if (finalIsHealthy === true) {
    statusClass = 'healthy';
    displayText = healthyText;
  } else if (finalIsHealthy === false) {
    statusClass = 'unhealthy';
    displayText = unhealthyText;
  } else {
    statusClass = 'unknown';
    displayText = 'N/A';
  }

  return (
    <div className={`health-item ${statusClass}`}>
      <span>{title}</span>
      <span className="health-indicator">{displayText}</span>
    </div>
  );
}
export default HealthStatus;
</file>

<file path="src/components/PensSidebar.jsx">
// src/components/PensSidebar.jsx
import { tagColorMap } from '../constants';

function PensSidebar({ chartDefinitions, visiblePens, onTogglePen }) {
  // Safety check
  if (!chartDefinitions || !Array.isArray(chartDefinitions)) {
      return null;
  }
  
  return (
    <div className="sidebar pens-sidebar">
      <h2>Chart Pens</h2>
      {chartDefinitions.map(chart => (
        <div key={chart.title} className="pen-group">
          <h4>{chart.title}</h4>
          {Array.isArray(chart.tags) && chart.tags.map(penName => (
            <div className="pen-item" key={penName}>
              <div 
                className="pen-color-swatch" 
                style={{ backgroundColor: tagColorMap[penName] }}
              ></div>
              <input
                type="checkbox"
                id={`pen-${chart.title}-${penName}`} // Unique ID
                // Check if this pen is in the visible list for this specific chart
                checked={visiblePens[chart.title]?.includes(penName) || false}
                onChange={() => onTogglePen(chart.title, penName)}
              />
              <label htmlFor={`pen-${chart.title}-${penName}`}>{penName}</label>
            </div>
          ))}
        </div>
      ))}
    </div>
  );
}

export default PensSidebar;
</file>

<file path="src/components/ProtectedRoute.jsx">
import { useLocation, Navigate } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

function ProtectedRoute({ children, adminOnly = false }) {
  const { user, token, isLoading } = useAuth();
  const location = useLocation();

  if (isLoading) {
    return <div style={{padding: '2rem'}}>Loading authentication...</div>;
  }

  if (!token) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }
  
  if (adminOnly && user?.role !== 'Admin') {
    return <Navigate to="/" replace />; // Not an admin, send to home
  }

  return children;
}
export default ProtectedRoute;
</file>

<file path="src/components/StreamingChart.jsx">
import { useState, useEffect, useRef, useMemo } from "react";
import { Line } from "react-chartjs-2";
import { 
    Chart as ChartJS, 
    CategoryScale, 
    LinearScale, 
    PointElement, 
    LineElement, 
    Title, 
    Tooltip, 
    Legend, 
    TimeScale,
    Decimation 
} from "chart.js";
import 'chartjs-adapter-date-fns';
import apiClient from '../api';
import { subSeconds } from 'date-fns';

ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Tooltip, Legend, TimeScale, Decimation);

function StreamingChart({ selectedTags, displayRangeSec, tagColorMap }) {
  const rawDataRef = useRef({});
  const [chartData, setChartData] = useState({ datasets: [] });
  const [isLoading, setIsLoading] = useState(true);
  const pollingRef = useRef(null);
  
  const pollInterval = 100; // 10Hz

  // --- DUAL MODE CONFIGURATION ---
  // "Safe Mode" (<= 5 mins): Standard rendering. Reliable.
  // "Performance Mode" (> 5 mins): Decimation ON, Parsing OFF. Fast.
  const isPerformanceMode = displayRangeSec > 300; 

  const chartOptions = useMemo(() => {
    // BASE OPTIONS
    const opts = {
        responsive: true, 
        maintainAspectRatio: false, 
        animation: false, 
        spanGaps: false,
        plugins: { 
            legend: { display: false },
            decimation: { enabled: false } // Default disabled
        },
        scales: {
            x: {
                type: "time",
                time: { unit: "second", tooltipFormat: "HH:mm:ss.SSS" },
                ticks: { color: '#a0a0a0', maxRotation: 0, autoSkip: true, maxTicksLimit: 10, source: 'auto' },
                grid: { color: '#333' }
            },
            y: { ticks: { color: '#a0a0a0' }, grid: { color: '#333' } },
        },
        elements: {
            line: { tension: 0, borderWidth: 2 },
            point: { radius: 0, hoverRadius: 5 } // Default hidden
        }
    };

    if (isPerformanceMode) {
        // --- PERFORMANCE MODE (> 5 mins) ---
        opts.parsing = false; // Trust our x: ms data
        opts.normalized = true;
        opts.plugins.decimation = {
            enabled: true,
            algorithm: 'min-max',
            samples: 500, 
        };
    } else {
        // --- SAFE MODE (<= 5 mins) ---
        opts.parsing = true; // Let Chart.js parse the ISO strings/Date objs
        // Show dots only if range is very short (1 min or less)
        if (displayRangeSec <= 120) {
            opts.elements.point.radius = 2;
        }
    }

    return opts;
  }, [isPerformanceMode, displayRangeSec]);

  const mergeAndSetData = (incomingData, endTime, windowSeconds) => {
    const newRawData = { ...rawDataRef.current };

    selectedTags.forEach((tag) => {
      if (!newRawData[tag]) newRawData[tag] = [];
      const existingTimestamps = new Set(newRawData[tag].map((p) => p.ts));
      
      if (incomingData[tag] && Array.isArray(incomingData[tag])) {
          incomingData[tag].forEach((newPoint) => {
            if (existingTimestamps.has(newPoint.ts)) return;
            // Basic validation
            if (newPoint.value === null || newPoint.value === undefined) return;
            const numericValue = parseFloat(newPoint.value);
            if (isNaN(numericValue)) return;

            newRawData[tag].push({ ts: newPoint.ts, value: numericValue });
          });
      }
      
      // Prune old
      const cutoff = subSeconds(endTime, windowSeconds).getTime();
      newRawData[tag] = newRawData[tag].filter(
        (p) => new Date(p.ts).getTime() >= cutoff
      );
      
      newRawData[tag].sort((a, b) => new Date(a.ts).getTime() - new Date(b.ts).getTime());
    });

    rawDataRef.current = newRawData;

    const datasets = selectedTags.map((tag) => {
        const rawPoints = rawDataRef.current[tag] || [];
        
        // DATA TRANSFORMATION BASED ON MODE
        let dataPoints;
        if (isPerformanceMode) {
            // Performance Mode: Needs {x: Milliseconds, y: Value}
            dataPoints = rawPoints.map(p => ({ x: new Date(p.ts).getTime(), y: p.value }));
        } else {
            // Safe Mode: Needs {x: ISO String, y: Value} (Standard parsing)
            dataPoints = rawPoints.map(p => ({ x: p.ts, y: p.value }));
        }

        return {
            label: tag,
            data: dataPoints,
            borderColor: tagColorMap[tag],
            backgroundColor: tagColorMap[tag] + '80',
        };
    });

    setChartData({ datasets });
  };

  useEffect(() => {
    rawDataRef.current = {};
    if (pollingRef.current) clearTimeout(pollingRef.current);
    setIsLoading(true);

    let isMounted = true;

    const runProcess = async () => {
      const now = new Date();
      
      // 1. Initial Backfill
      try {
        const start = subSeconds(now, displayRangeSec);
        const params = new URLSearchParams();
        selectedTags.forEach(tag => params.append('tags', tag));
        params.append('start_time', start.toISOString());
        params.append('end_time', now.toISOString());

        const histResponse = await apiClient.get('/api/historian', { params });
        if (isMounted) {
            mergeAndSetData(histResponse.data, now, displayRangeSec);
            setIsLoading(false); 
        }
      } catch (e) {
        if (isMounted) setIsLoading(false);
      }

      // 2. Polling Loop
      const poll = async () => {
        if (!isMounted) return;
        const loopNow = new Date();
        const loopStart = subSeconds(loopNow, 60); 

        try {
          const params = new URLSearchParams();
          selectedTags.forEach(tag => params.append('tags', tag));
          params.append('start_time', loopStart.toISOString());
          params.append('end_time', loopNow.toISOString());

          const liveResponse = await apiClient.get('/api/historian', { params });
          if (isMounted) {
            mergeAndSetData(liveResponse.data, loopNow, displayRangeSec);
          }
        } catch (e) { }
        pollingRef.current = setTimeout(poll, pollInterval);
      };

      poll();
    };

    runProcess();

    return () => {
      isMounted = false;
      if (pollingRef.current) clearTimeout(pollingRef.current);
    };
  }, [selectedTags, displayRangeSec]); 

  if (isLoading) {
    return (
        <div style={{
            height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', 
            color: '#a0a0a0', flexDirection: 'column', gap: '10px'
        }}>
            <span>Loading Data...</span>
        </div>
    );
  }

  // Key forces full re-mount when switching between Safe/Performance modes
  return (
    <Line 
        key={isPerformanceMode ? 'perf' : 'safe'} 
        data={chartData} 
        options={chartOptions} 
    />
  );
};

export default StreamingChart;
</file>

<file path="src/constants/index.js">
// src/constants/index.js

export const COLORS = ['#3498db', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6', '#1abc9c', '#e67e22', '#34495e'];

export const chartDefinitions = [
    { title: "Power Output & Speed", tags: ['VFD_Sts_OutPowerScaled', 'VFD_Sts_MtrSpeedScaled'] },
    { title: "System Vibration & Temperature", tags: ['VT001.Scaled', 'VT002.Scaled', 'TT001.Scaled', 'TT002.Scaled', 'TT003.Scaled'] },
    { title: "Electromagnet & Load Cell", tags: ['EM001_Rescaled', 'WT001.Scaled', 'EM_SV'] }
];

export const allPossibleTags = [...new Set(chartDefinitions.flatMap(c => c.tags))];

// The map is created once and exported for global use
export const tagColorMap = Object.fromEntries(
    allPossibleTags.map((tag, index) => [tag, COLORS[index % COLORS.length]])
);
</file>

<file path="src/context/AuthContext.jsx">
import { createContext, useState, useContext, useEffect } from 'react';
import apiClient from '../api';

const AuthContext = createContext(null);

export const AuthProvider = ({ children }) => {
  const [token, setToken] = useState(localStorage.getItem('authToken'));
  const [user, setUser] = useState(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const verifyToken = async () => {
      if (token) {
        try {
          apiClient.defaults.headers.common['Authorization'] = `Bearer ${token}`;
          const userResponse = await apiClient.get('/users/me');
          setUser(userResponse.data);
        } catch (error) {
          console.error("Auth token is invalid, logging out:", error);
          logout();
        }
      }
      setIsLoading(false);
    };
    verifyToken();
  }, [token]);

  const login = async (username, password) => {
    try {
      const params = new URLSearchParams();
      params.append('username', username);
      params.append('password', password);
      const response = await apiClient.post('/token', params);
      const { access_token } = response.data;
      setToken(access_token);
      localStorage.setItem('authToken', access_token);
      return true;
    } catch (error) {
      console.error("Login failed:", error);
      logout();
      return false;
    }
  };

  const logout = () => {
    setToken(null);
    setUser(null);
    localStorage.removeItem('authToken');
    delete apiClient.defaults.headers.common['Authorization'];
  };
  
  const value = { token, user, login, logout, isLoading };

  return (
    <AuthContext.Provider value={value}>
      {isLoading ? <div>Loading Application...</div> : children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);
</file>

<file path="src/pages/EngineeringPage.jsx">
import { useState, useEffect } from 'react';
import { useOutletContext } from "react-router-dom";
import apiClient from '../api';

function SetpointManager() {
    const { setpoints, setSetpoints } = useOutletContext();
    const [localSettings, setLocalSettings] = useState(setpoints); 

    // Sync local state when global setpoints load, but only if user isn't actively editing
    // (Simplification: just sync when setpoints change externally or on load)
    useEffect(() => { 
        if (setpoints) setLocalSettings(setpoints); 
    }, [setpoints]);

    if (!setpoints || Object.keys(setpoints).length === 0) return <div className="card"><h2>Loading Setpoints...</h2></div>;

    const handleInputChange = (key, value) => {
        // Allow empty string for typing, otherwise store raw value
        setLocalSettings(prev => ({ ...prev, [key]: value }));
    };

    const handleSave = async (key) => {
        const rawValue = localSettings[key];
        const numValue = rawValue === '' ? 0 : parseFloat(rawValue); // Default to 0 if empty on save
        
        try {
            await apiClient.put(`/api/settings/setpoint_${key}`, { key: `setpoint_${key}`, value: numValue });
            setSetpoints(prev => ({ ...prev, [key]: numValue }));
            // Update local settings to the sanitized number
            setLocalSettings(prev => ({ ...prev, [key]: numValue }));
            alert(`Setting '${key}' saved successfully!`);
        } catch (err) { 
            alert('Failed to update setting.'); 
            console.error("Failed to save setting:", err);
        }
    };
    
    // Helper to safely render input value
    const getValue = (val) => (val === undefined || val === null) ? '' : val;

    return (
        <div className="card">
            <h2>Command Setpoints (Engineer)</h2>
            <p>Configure the value sent to the PLC for each command.</p>
            {['charge', 'discharge', 'shutdown', 'idle'].map((key) => (
                <div className="form-group-with-button" key={key}>
                    <label>{key.charAt(0).toUpperCase() + key.slice(1)} Value:</label>
                    <input 
                        type="number" 
                        value={getValue(localSettings[key])} 
                        onChange={(e) => handleInputChange(key, e.target.value)} 
                    />
                    <button onClick={() => handleSave(key)}>Save</button>
                </div>
            ))}
        </div>
    );
}

function TagManager() {
    const [tags, setTags] = useState([]);
    useEffect(() => {
        const fetchTags = async () => {
            try {
                const response = await apiClient.get('/api/tags');
                setTags(response.data);
            } catch (err) { console.error('Failed to fetch tags:', err); }
        };
        fetchTags();
    }, []);

    const handleToggle = async (tagId, currentStatus) => {
        try {
            await apiClient.put(`/api/tags/${tagId}`, { is_active: !currentStatus });
            setTags(prevTags => prevTags.map(tag => tag.id === tagId ? { ...tag, is_active: !currentStatus } : tag));
        } catch (err) { alert('Failed to update tag.'); }
    };

    return (
        <div className="card" style={{marginTop: '2rem'}}>
            <h2>Tag Polling Configuration (Admin)</h2>
            <table className="tag-table">
                <thead><tr><th>ID</th><th>Tag Name</th><th>Data Type</th><th>Status</th></tr></thead>
                <tbody>
                    {tags.map(tag => (
                        <tr key={tag.id}>
                            <td>{tag.id}</td><td>{tag.tag}</td><td>{tag.datatype}</td>
                            <td><button className={`status-toggle ${tag.is_active ? 'active' : 'inactive'}`} onClick={() => handleToggle(tag.id, tag.is_active)}>{tag.is_active ? 'ACTIVE' : 'INACTIVE'}</button></td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    );
}

function EngineeringPage() {
    const { user } = useOutletContext();
    return (
        <div className="engineering-layout">
            <div>
                <SetpointManager />
                {user?.role === 'Admin' && <TagManager />}
            </div>
        </div>
    );
}
export default EngineeringPage;
</file>

<file path="src/pages/HomePage.jsx">
import { useState, useEffect } from 'react';
import { useOutletContext } from "react-router-dom";
import apiClient from '../api';
import CommandsSidebar from '../components/CommandsSidebar';
import FlywheelVisual from '../components/FlywheelVisual';
import HealthStatus from '../components/HealthStatus';

function HomePage() {
  const { setpoints } = useOutletContext();
  const [liveData, setLiveData] = useState({ status: 'initializing', tags: {} });

  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await apiClient.get('/api/live-data');
        setLiveData(response.data);
      } catch (error) {
        console.error("Error fetching live data:", error);
        setLiveData(prevData => ({ ...prevData, status: 'disconnected' }));
      }
    };
    fetchData();
    const intervalId = setInterval(fetchData, 1000);
    return () => clearInterval(intervalId);
  }, []);

  const tags = liveData.tags || {};
  const maxSpeed = 1800;
  const currentSpeed = tags['VFD_Sts_MtrSpeedScaled'] || 0;
  const powerOutput = tags['VFD_Sts_OutPowerScaled'] || 0;
  const dcVolts = tags['VFD_Sts_DCVolts'] || 0;
  const temp1 = tags['TT001.Scaled'];
  const temp2 = tags['TT002.Scaled'];
  const totalEnergy = tags['Test_InfiniteCounter'] || 0;
  const setpointSent = tags['Test_OutputVal1'];
  const setpointReadback = tags['Test_InputVal1'];
  const isTripped = tags['VFD_Sts_Tripped'];
  const hasWarning = tags['VFD_Sts_Warning'];
  const psu1Healthy = tags['PSU001_HLTY'];
  const psu2Healthy = tags['PSU002_HLTY'];
  const flywheelPercentage = (currentSpeed / maxSpeed) * 100;
  
  let flywheelStatus = "Idle";
  if (powerOutput > 0.5) flywheelStatus = "Charging";
  else if (powerOutput < -0.5) flywheelStatus = "Discharging";

  return (
    <div className="home-layout">
      <CommandsSidebar setpoints={setpoints} />
      <FlywheelVisual 
        percentage={flywheelPercentage}
        status={flywheelStatus}
      />
      <div className="sidebar status-sidebar">
        <div className="status-group">
          <h2>Overview</h2>
          <div className="status-item"><span>Status</span><span>{flywheelStatus}</span></div>
          <div className="status-item"><span>Power</span><span>{powerOutput.toFixed(2)} kW</span></div>
          <div className="status-item"><span>Speed</span><span>{currentSpeed} RPM</span></div>
          <div className="status-item"><span>DC Voltage</span><span>{dcVolts} V</span></div>
          <div className="status-item"><span>Total Energy</span><span>{(totalEnergy / 1000).toFixed(1)} kWh</span></div>
        </div>
        <div className="status-group">
          <h2>Temperatures</h2>
          <div className="status-item"><span>Bearing 1</span><span>{typeof temp1 === 'number' ? temp1.toFixed(1) + ' °C' : 'N/A'}</span></div>
          <div className="status-item"><span>Bearing 2</span><span>{typeof temp2 === 'number' ? temp2.toFixed(1) + ' °C' : 'N/A'}</span></div>
        </div>
        <div className="status-group">
          <h2>System Health</h2>
          <HealthStatus title="VFD Tripped" value={isTripped} isHealthy={!isTripped} unhealthyText="TRIPPED" />
          <HealthStatus title="VFD Warning" value={hasWarning} isHealthy={!hasWarning} unhealthyText="WARNING" />
          <HealthStatus title="PSU 1" value={psu1Healthy} />
          <HealthStatus title="PSU 2" value={psu2Healthy} />
        </div>
        <div className="status-group">
          <h2>Setpoint Feedback</h2>
          <div className="status-item debug-item">
            <span>Setpoint Sent:</span>
            <span>{typeof setpointSent === 'number' ? setpointSent.toFixed(2) : 'N/A'}</span>
          </div>
          <div className="status-item debug-item" style={{ color: '#00c4ff' }}>
            <span>Setpoint Readback (2x):</span>
            <span>{typeof setpointReadback === 'number' ? setpointReadback.toFixed(2) : 'N/A'}</span>
          </div>
        </div>
      </div>
    </div>
  );
}
export default HomePage;
</file>

<file path="src/pages/LoginPage.jsx">
import { useState } from 'react';
import { useAuth } from '../context/AuthContext';
import { useNavigate, useLocation } from 'react-router-dom';

function LoginPage() {
  const [username, setUsername] = useState('admin'); // Default for convenience
  const [password, setPassword] = useState('password'); // Default for convenience
  const [error, setError] = useState('');
  const auth = useAuth();
  const navigate = useNavigate();
  const location = useLocation();
  
  const from = location.state?.from?.pathname || "/";

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    const success = await auth.login(username, password);
    if (success) {
      navigate(from, { replace: true });
    } else {
      setError('Invalid username or password.');
    }
  };

  return (
    <div className="login-container">
      <form onSubmit={handleSubmit} className="card">
        <h2>Login Required</h2>
        <p>You must log in to view this page.</p>
        {error && <p className="error-message">{error}</p>}
        <div className="form-group">
          <label htmlFor="username">Username</label>
          <input type="text" id="username" value={username} onChange={e => setUsername(e.target.value)} required />
        </div>
        <div className="form-group">
          <label htmlFor="password">Password</label>
          <input type="password" id="password" value={password} onChange={e => setPassword(e.target.value)} required />
        </div>
        <button type="submit">Log In</button>
      </form>
    </div>
  );
}
export default LoginPage;
</file>

<file path="src/pages/OperationalDetailsPage.jsx">
import { useState, useEffect } from 'react';
import { Line } from 'react-chartjs-2';
import { 
    Chart as ChartJS, 
    CategoryScale, 
    LinearScale, 
    PointElement, 
    LineElement, 
    Title, 
    Tooltip, 
    Legend, 
    TimeScale 
} from 'chart.js';
import 'chartjs-adapter-date-fns';
import { subSeconds, subHours, subDays, subMonths, startOfYear } from 'date-fns';

import PensSidebar from '../components/PensSidebar';
import StreamingChart from '../components/StreamingChart';
import { chartDefinitions, tagColorMap } from '../constants';
import apiClient from '../api'; 

ChartJS.register(CategoryScale, LinearScale, PointElement, LineElement, Title, Tooltip, Legend, TimeScale);

const staticChartOptions = {
    responsive: true, 
    maintainAspectRatio: false, 
    parsing: false, 
    normalized: true,
    plugins: { 
        legend: { display: true, position: 'top', labels: { color: '#a0a0a0' } } 
    },
    scales: {
        x: { 
            type: 'time', 
            time: { tooltipFormat: 'PP pp' }, 
            ticks: { color: '#a0a0a0', maxRotation: 0, autoSkip: true, maxTicksLimit: 10 }, 
            grid: { color: '#333' } 
        },
        y: { 
            ticks: { color: '#a0a0a0' }, 
            grid: { color: '#333' } 
        }
    },
    animation: { duration: 0 }
};

const getDurationInSeconds = (timeRangeKey) => {
    const value = parseInt(timeRangeKey.slice(0, -1));
    const unit = timeRangeKey.slice(-1);
    if (unit === 's') return value;
    if (unit === 'm') return value * 60;
    return 0; 
};

const getStartEndTime = (timeRangeKey) => {
    const now = new Date();
    let startTime = null;

    if (timeRangeKey === '1h') startTime = subHours(now, 1);
    else if (timeRangeKey === '24h') startTime = subHours(now, 24);
    else if (timeRangeKey === '7d') startTime = subDays(now, 7);
    else if (timeRangeKey === '1mo') startTime = subMonths(now, 1);
    else if (timeRangeKey === 'YTD') startTime = startOfYear(now);
    else if (timeRangeKey === 'All') startTime = new Date(0); 

    return { startTime, endTime: now };
};

// --- UPDATED: LiveSensorTable with Maximize/Grid Logic ---
function LiveSensorTable({ tags }) {
    const [isMaximized, setIsMaximized] = useState(false);

    if (!tags) return <div className="sidebar sensor-sidebar">Loading...</div>;
    const sortedTags = Object.entries(tags).sort((a, b) => a[0].localeCompare(b[0]));

    return (
        <div className={`sidebar sensor-sidebar ${isMaximized ? 'maximized' : ''}`}>
            <div className="sidebar-header-row">
                <h2>{isMaximized ? 'Sensor Wall Monitor' : 'Live Values'}</h2>
                <button 
                    className="maximize-btn" 
                    onClick={() => setIsMaximized(!isMaximized)}
                >
                    {isMaximized ? 'Minimize' : '⤢ Expand'}
                </button>
            </div>
            
            <div className="sensor-list">
                {sortedTags.length === 0 ? (
                    <div style={{padding: '1rem', color: '#666'}}>No active tags found.</div>
                ) : (
                    sortedTags.map(([tagName, value]) => (
                        <div className="sensor-item" key={tagName}>
                            <span className="sensor-label">{tagName}</span>
                            <span className="sensor-value">
                                {typeof value === 'number' ? value.toFixed(2) : String(value)}
                            </span>
                        </div>
                    ))
                )}
            </div>
        </div>
    );
}

const IndividualTimeSelector = ({ onSelect }) => {
    const ranges = {
        '1m': '1 Minute (Live)',
        '5m': '5 Minutes (Live)',
        '30m':'30 Minutes (Live)',
        '1h': '1 Hour (History)',
        '24h': '24 Hours (History)',
        '7d': '7 Days (History)',
        '1mo': '1 Month (History)',
        'YTD': 'Year to Date',
        'All': 'All Time'
    };

    return (
        <div className="individual-time-selector">
            <span>Range:</span>
            <select onChange={(e) => onSelect(e.target.value)} defaultValue="5m">
                {Object.entries(ranges).map(([key, label]) => (
                    <option key={key} value={key}>{label}</option>
                ))}
            </select>
        </div>
    );
};

function HistorianChart({ title, visibleTags }) {
    const [timeRange, setTimeRange] = useState('5m'); 
    const [staticData, setStaticData] = useState({ datasets: [] });
    const [isLoadingHistory, setIsLoadingHistory] = useState(false);

    const isStreamingMode = ['1s', '5s', '10s', '30s', '1m', '5m', '15m', '30m'].includes(timeRange);

    useEffect(() => {
        if (isStreamingMode || visibleTags.length === 0) return;

        const fetchHistory = async () => {
            setIsLoadingHistory(true);
            try {
                const { startTime, endTime } = getStartEndTime(timeRange);
                const params = new URLSearchParams();
                visibleTags.forEach(tag => params.append('tags', tag));
                if (startTime) params.append('start_time', startTime.toISOString());
                params.append('end_time', endTime.toISOString());

                const response = await apiClient.get('/api/historian', { params });
                const data = response.data;

                const newDatasets = visibleTags.map(tagName => ({
                    label: tagName,
                    data: data[tagName]?.map(p => ({ x: new Date(p.ts).getTime(), y: p.value })) || [],
                    borderColor: tagColorMap[tagName] || '#888',
                    backgroundColor: (tagColorMap[tagName] || '#888') + '80',
                    tension: 0.2, 
                    pointRadius: 0, 
                    borderWidth: 2,
                }));

                setStaticData({ datasets: newDatasets });
            } catch (error) {
                console.error(`History fetch failed for ${title}:`, error);
            } finally {
                setIsLoadingHistory(false);
            }
        };

        fetchHistory();
    }, [timeRange, visibleTags, isStreamingMode, title]);

    return (
        <div className="chart-card-container">
            <div className="chart-header">
                <h3>
                    {title} 
                    {isStreamingMode ? 
                        <span className="live-badge" style={{marginLeft:'10px'}}>LIVE</span> : 
                        <span style={{marginLeft:'10px', fontSize:'0.7em', color:'#a0a0a0'}}>HISTORICAL</span>
                    }
                </h3>
                <IndividualTimeSelector onSelect={setTimeRange} />
            </div>

            <div className="chart-wrapper">
                {visibleTags.length === 0 ? (
                    <div className="no-data-message">No Pens Selected</div>
                ) : isStreamingMode ? (
                    <StreamingChart 
                        selectedTags={visibleTags}
                        displayRangeSec={getDurationInSeconds(timeRange)}
                        tagColorMap={tagColorMap}
                    />
                ) : (
                    isLoadingHistory ? (
                        <div className="loading-message">Loading History...</div>
                    ) : (
                        <Line options={staticChartOptions} data={staticData} />
                    )
                )}
            </div>
        </div>
    );
}

function OperationalDetailsPage() {
    const [liveTags, setLiveTags] = useState({});
    const [visiblePens, setVisiblePens] = useState(() => {
        const initial = {};
        chartDefinitions.forEach(def => {
            initial[def.title] = def.tags; 
        });
        return initial;
    });

    useEffect(() => {
        const fetchLive = async () => {
            try {
                const resp = await apiClient.get('/api/live-data');
                setLiveTags(resp.data.tags || {});
            } catch (err) { 
                console.error("Live data error:", err); 
            }
        };
        fetchLive(); 
        const intervalId = setInterval(fetchLive, 1000); 
        return () => clearInterval(intervalId);
    }, []);

    const handleTogglePen = (chartTitle, penName) => {
        setVisiblePens(prev => {
            const currentList = prev[chartTitle] || [];
            if (currentList.includes(penName)) {
                return { ...prev, [chartTitle]: currentList.filter(p => p !== penName) };
            } else {
                return { ...prev, [chartTitle]: [...currentList, penName] };
            }
        });
    };

    return (
        <div className="details-layout-final">
            <PensSidebar 
                chartDefinitions={chartDefinitions} 
                visiblePens={visiblePens} 
                onTogglePen={handleTogglePen} 
            />
            <div className="charts-container-final">
                {chartDefinitions.map(chart => (
                    <HistorianChart 
                        key={chart.title}
                        title={chart.title} 
                        visibleTags={visiblePens[chart.title] || []}
                    />
                ))}
            </div>
            <LiveSensorTable tags={liveTags} />
        </div>
    );
}

export default OperationalDetailsPage;
</file>

<file path="src/api.js">
// src/api.js
import axios from 'axios';

// CRITICAL: Point to your server's actual LAN IP
export const BASE_API_URL = 'http://localhost:8000';
const API_KEY = import.meta.env.VITE_API_KEY;

const apiClient = axios.create({
  baseURL: BASE_API_URL,
});

apiClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('authToken');
    if (token) config.headers['Authorization'] = `Bearer ${token}`;
    if (API_KEY) config.headers['x-api-key'] = API_KEY;
    return config;
  },
  (error) => Promise.reject(error)
);

export default apiClient;
</file>

<file path="src/App.css">
/* --- GLOBAL STYLES & DARK THEME --- */
:root {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background-color: #1e1e1e;
  color: #dcdcdc;
}
body { margin: 0; }
.App { display: flex; flex-direction: column; height: 100vh; width: 100vw; }
.main-content { flex-grow: 1; overflow-y: auto; }

/* Custom Scrollbar for Dark Theme */
::-webkit-scrollbar { width: 10px; height: 10px; }
::-webkit-scrollbar-track { background: #2d2d2d; }
::-webkit-scrollbar-thumb { background: #555; border-radius: 5px; }
::-webkit-scrollbar-thumb:hover { background: #777; }

/* --- HEADER & NAVIGATION --- */
.App-header { display: flex; align-items: center; background-color: #2d2d2d; padding: 0 2rem; height: 60px; border-bottom: 1px solid #444; flex-shrink: 0; }
.logo-container img { height: 40px; }
.navigation { flex-grow: 1; display: flex; justify-content: center; gap: 1rem; }
.navigation a { color: #a0a0a0; text-decoration: none; font-size: 1.1em; padding: 0.5rem 1rem; border-radius: 6px; transition: background-color 0.2s; }
.navigation a.active, .navigation a:hover { color: #ffffff; background-color: #444; }
.header-right-side { display: flex; align-items: center; gap: 1.5rem; margin-left: auto; }
.status-time { color: #a0a0a0; white-space: nowrap; font-variant-numeric: tabular-nums; }
.logout-button { background-color: #3a3a3a; color: #a0a0a0; border: 1px solid #555; border-radius: 6px; padding: 0.5rem 1rem; font-size: 1em; cursor: pointer; transition: all 0.2s; }
.logout-button:hover { background-color: #c0392b; color: white; border-color: #e74c3c; }

/* --- GENERIC COMPONENTS --- */
.sidebar { background-color: #2d2d2d; border-radius: 8px; overflow-y: auto; }
.card { background-color: #2d2d2d; border-radius: 8px; padding: 1.5rem; }

/* --- HOME PAGE --- */
.home-layout { 
  display: grid; 
  grid-template-columns: 300px 1fr 350px; 
  height: calc(100vh - 60px); 
  overflow: hidden; 
}

.commands-sidebar { padding: 2rem; display: flex; flex-direction: column; gap: 1.5rem; }
.commands-sidebar h2 { margin: 0 0 1rem 0; font-size: 1.5em; font-weight: 600; border-bottom: 1px solid #444; padding-bottom: 1rem; }
.commands-sidebar button { width: 100%; padding: 1.2rem; font-size: 1.5em; border-radius: 8px; border: 1px solid #555; background-color: #3a3a3a; color: #dcdcdc; cursor: pointer; transition: background-color 0.2s; }
.commands-sidebar button:hover { background-color: #4a4a4a; }
.commands-sidebar button:disabled { background-color: #2a2a2a; color: #666; cursor: not-allowed; border-color: #444; }

.status-sidebar { padding: 2rem; }
.status-group { margin-bottom: 2rem; }
.status-group h2 { margin: 0 0 1rem 0; font-size: 1.5em; font-weight: 600; border-bottom: 1px solid #444; padding-bottom: 1rem; }
.status-item { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0; border-bottom: 1px solid #444; font-size: 1.1em; }
.status-item:last-child { border-bottom: none; }
.status-item span:first-child { color: #a0a0a0; }
.status-item span:last-child { font-weight: bold; font-size: 1.1em; font-variant-numeric: tabular-nums; }
.debug-item span:first-child { color: #f0a !important; font-style: italic; }

/* --- IMPROVED FLYWHEEL VISUAL --- */
.flywheel-container { 
  display: flex; flex-direction: column; align-items: center; justify-content: center; 
  gap: 1.5rem; padding: 2rem; position: relative; color: #a0a0a0; 
  overflow: hidden;
}
.flywheel-visual { 
  width: 200px; height: 200px; /* Made square for rotation */
  border: 6px solid #555; border-radius: 50%; /* Circular */
  position: relative; display: flex; align-items: center; justify-content: center; 
  overflow: hidden; 
  background: radial-gradient(circle at center, #333 0%, #1a1a1a 100%);
  box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.8); 
  transition: border-color 0.3s;
}

/* The spinning content */
.flywheel-fill { 
  position: absolute; width: 100%; height: 100%; top: 0; left: 0;
  background: conic-gradient(from 0deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%);
  border-radius: 50%;
  opacity: 0.5;
}

/* Animations for spinning */
@keyframes spin { 100% { transform: rotate(360deg); } }
.spinning-charge { animation: spin 0.5s linear infinite; border-color: #2ecc71; }
.spinning-discharge { animation: spin 0.5s linear infinite reverse; border-color: #3498db; }

/* Text overlaid on top */
.flywheel-text { 
  position: absolute; z-index: 10; 
  display: flex; flex-direction: column; align-items: center;
  color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.9); font-size: 1.5em; font-weight: 600; 
}
.power-flow-arrow { font-size: 3em; font-weight: bold; line-height: 1; min-height: 1em; }

/* --------------------------------------------------------- */

.health-item { display: flex; justify-content: space-between; align-items: center; font-size: 1.1em; margin-bottom: 0.8rem; }
.health-indicator { font-weight: bold; padding: 0.2rem 0.6rem; border-radius: 5px; }
.health-item.healthy .health-indicator { background-color: #27ae60; color: white; }
.health-item.unhealthy .health-indicator { background-color: #c0392b; color: white; }
.health-item.unknown .health-indicator { background-color: #7f8c8d; color: white; }

/* --- OPERATIONAL DETAILS PAGE --- */
.details-layout-final { 
  display: grid; grid-template-columns: 250px 1fr 350px; 
  height: calc(100vh - 60px); 
  gap: 1rem; padding: 1rem; box-sizing: border-box;
}

.charts-container-final { display: flex; flex-direction: column; gap: 1.5rem; overflow-y: auto; padding-right: 0.5rem; }
.pens-sidebar { padding: 1rem; }
.pen-group h4 { margin: 0 0 1rem 0; border-bottom: 1px solid #555; padding-bottom: 0.5rem; }
.pen-item { display: flex; align-items: center; margin-bottom: 0.75rem; font-size: 0.9em; }
.pen-color-swatch { width: 15px; height: 15px; margin-right: 0.75rem; border: 1px solid #555; border-radius: 3px; }
.pen-item input { margin-right: 0.5rem; }
.pen-item label { cursor: pointer; user-select: none; }

.chart-card-container { display: grid; grid-template-columns: 220px 1fr; gap: 1rem; background-color: #2d2d2d; padding: 1rem; border-radius: 8px; height: 350px; }
.chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; height: 40px; }
.chart-header h3 { margin: 0; font-size: 1.2em; display: flex; align-items: center; gap: 0.5rem; }
.live-badge { background-color: #c0392b; color: white; font-size: 0.7em; padding: 2px 6px; border-radius: 4px; animation: pulse 2s infinite; }
@keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

.individual-time-selector { display: flex; align-items: center; gap: 0.5rem; }
.individual-time-selector select { padding: 0.3rem; border-radius: 4px; background-color: #3a3a3a; color: #dcdcdc; border: 1px solid #555; }
.chart-wrapper { height: calc(100% - 45px); position: relative; width: 100%; }

.sensor-sidebar { padding: 1rem; }
.sensor-list { display: flex; flex-direction: column; gap: 0.8rem; }
.sensor-item { display: flex; justify-content: space-between; align-items: center; font-size: 1em; border-bottom: 1px solid #444; padding-bottom: 0.8rem; }
.sensor-item:last-child { border-bottom: none; }
.sensor-value { font-variant-numeric: tabular-nums; font-family: monospace; font-size: 1.1em; color: #41D1FF; }

/* --- ENGINEERING & LOGIN PAGES --- */
.engineering-layout, .login-container { padding: 2rem; display: flex; justify-content: center; width: 100%; box-sizing: border-box; }
.engineering-layout > div, .login-container form { width: 100%; max-width: 600px; }
.form-group { display: flex; flex-direction: column; margin-bottom: 1.5rem; }
.form-group label { margin-bottom: 0.5rem; color: #a0a0a0; }
.form-group input { padding: 0.8rem; border-radius: 6px; background-color: #1e1e1e; color: #dcdcdc; border: 1px solid #555; font-size: 1.1em; }
.form-group-with-button { display: grid; grid-template-columns: 1fr 120px 80px; gap: 1rem; align-items: center; margin-bottom: 1rem; }
.tag-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
.tag-table th, .tag-table td { padding: 0.8rem; text-align: left; border-bottom: 1px solid #444; }
.tag-table th { background-color: #3a3a3a; }
.status-toggle { border: none; cursor: pointer; padding: 0.5rem 1rem; border-radius: 5px; font-weight: bold; width: 100%; }
.status-toggle.active { background-color: #27ae60; color: white; }
.status-toggle.inactive { background-color: #7f8c8d; color: #ddd; }
.error-message { color: #e74c3c; font-weight: bold; margin-bottom: 1rem; }

/* --- RESPONSIVE MEDIA QUERIES --- */
@media (max-width: 1200px) {
  .home-layout, .details-layout-final {
    grid-template-columns: 1fr; /* Stack vertically */
    height: auto;
    overflow-y: auto;
  }
  .sidebar, .chart-card-container {
    height: auto;
    min-height: 400px;
  }
  .flywheel-container {
    padding: 3rem 0;
  }
  /* On mobile/tablet, stack the specific chart sidebar */
  .chart-card-container {
    grid-template-columns: 1fr;
    grid-template-rows: auto 400px;
  }
  .App-header {
    flex-wrap: wrap;
    height: auto;
    padding: 1rem;
    gap: 1rem;
  }
  .header-right-side {
    margin-left: 0;
    width: 100%;
    justify-content: space-between;
  }
}

/* --- OPERATIONAL DETAILS PAGE LAYOUT --- */
.details-layout-final { 
  display: grid; 
  /* Fixed Width Sidebar | Flexible Charts | Fixed Width Sidebar */
  grid-template-columns: 250px 1fr 300px; 
  height: calc(100vh - 60px); 
  gap: 1rem; 
  padding: 1rem; 
  box-sizing: border-box;
  overflow: hidden; /* Prevent the whole page from scrolling */
}

/* Middle Column: The Scrollable Chart Area */
.charts-container-final { 
  display: flex; 
  flex-direction: column; 
  gap: 1.5rem; 
  overflow-y: auto; /* Only this middle part scrolls */
  padding-right: 0.5rem; 
  min-height: 0; /* Crucial for nested flex scrolling */
}

/* Individual Chart Card */
.chart-card-container { 
  display: flex; 
  flex-direction: column; 
  background-color: #2d2d2d; 
  padding: 1rem; 
  border-radius: 8px; 
  /* Fixed height for each chart card ensures they don't collapse or explode */
  height: 400px; 
  flex-shrink: 0; /* Don't let them shrink smaller than 400px */
}

.chart-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 1rem; 
  height: 40px; 
}

/* The wrapper around the Canvas */
.chart-wrapper { 
  flex-grow: 1; 
  position: relative; 
  width: 100%; 
  min-height: 0; /* CRITICAL FIX: Stops chart from growing infinitely */
}

/* Message styling for Loading / No Data */
.no-data-message, .loading-message {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  color: #666;
  font-style: italic;
}

/* Sidebars */
.sidebar { 
  background-color: #2d2d2d; 
  border-radius: 8px; 
  overflow-y: auto; 
  height: 100%; /* Fill the grid cell */
}

/* Right Sidebar specific */
.sensor-list {
  padding-bottom: 2rem;
}

/* --- SENSOR SIDEBAR IMPROVEMENTS --- */

/* 1. Header with Maximize Button */
.sidebar-header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  border-bottom: 1px solid #444;
  padding-bottom: 0.5rem;
}

.sidebar-header-row h2 {
  margin: 0;
  font-size: 1.2em;
}

.maximize-btn {
  background-color: #333;
  color: #a0a0a0;
  border: 1px solid #555;
  padding: 0.3rem 0.6rem;
  font-size: 0.8em;
  border-radius: 4px;
}
.maximize-btn:hover {
  background-color: #41D1FF;
  color: #000;
  border-color: #41D1FF;
}

/* 2. Stacked Items (Label Top, Value Bottom) for readability */
.sensor-item {
  display: flex;
  flex-direction: column; /* Stack vertically */
  align-items: flex-start; /* Align left */
  border-bottom: 1px solid #444;
  padding: 0.8rem 0;
}

.sensor-label {
  font-size: 0.85em;
  color: #888;
  margin-bottom: 0.2rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sensor-value {
  font-size: 1.3em; /* Larger font for value */
  font-family: 'Courier New', monospace; /* Monospace for alignment */
  color: #41D1FF;
  font-weight: 600;
}

/* 3. MAXIMIZED MODE (The "Sensor Wall") */
.sensor-sidebar.maximized {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  background-color: #1a1a1a;
  padding: 2rem;
  box-sizing: border-box;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

/* When maximized, switch list to a Grid */
.sensor-sidebar.maximized .sensor-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Auto-fit grid */
  gap: 1.5rem;
  padding-top: 1rem;
}

.sensor-sidebar.maximized .sensor-item {
  background-color: #2d2d2d;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #444;
  border-bottom: 1px solid #444; /* Reset border */
}

.sensor-sidebar.maximized .sensor-label {
  color: #aaa;
}

.sensor-sidebar.maximized .sensor-value {
  font-size: 1.8em; /* Even bigger on big screen */
  margin-top: 0.5rem;
}

/* Scrollbar within sidebar */
.sensor-sidebar::-webkit-scrollbar { width: 6px; }
.sensor-sidebar::-webkit-scrollbar-thumb { background-color: #555; border-radius: 3px; }
</file>

<file path="src/App.jsx">
import { useState, useEffect } from 'react';
import { Outlet, NavLink, useNavigate } from "react-router-dom";
import { useAuth } from './context/AuthContext';
import apiClient from './api';
import './App.css';

function App() {
  const [currentTime, setCurrentTime] = useState(new Date());
  const [isClient, setIsClient] = useState(false);

  // local setpoints state (fixed / available to children via Outlet context)
  const [setpoints, setSetpoints] = useState({});

  const auth = useAuth();
  const { token, logout, user } = auth;
  const navigate = useNavigate();

  // --- Token listener for forced logout / redirect to login ---
  useEffect(() => {
    // don't run redirect logic during SSR/hydration (wait for client)
    if (!isClient) return;
    // if token/user gone, send to login
    if (!token && !user) {
      navigate('/login', { replace: true });
    }
  }, [token, user, isClient, navigate]);

  // --- Settings Fetch Logic (loads setpoints into local state) ---
  useEffect(() => {
    const fetchSettings = async () => {
      if (!token) return;
      try {
        const response = await apiClient.get('/api/settings');
        const settingsObj = response.data.reduce((acc, s) => {
          acc[s.key.replace('setpoint_', '')] = s.value;
          return acc;
        }, {});
        setSetpoints(settingsObj);
      } catch (error) {
        console.error("Could not fetch settings:", error);
      }
    };
    fetchSettings();
  }, [token]);

  // --- Live Clock Logic ---
  useEffect(() => {
    setIsClient(true);
    const timerId = setInterval(() => setCurrentTime(new Date()), 1000);
    return () => clearInterval(timerId);
  }, []);

  const formattedTime = currentTime.toLocaleString('en-US', {
    weekday: 'short', month: 'short', day: 'numeric',
    hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true,
  });

  // on logout, just call logout(); token listener will redirect
  const handleLogout = () => {
    logout();
  };

  // prefer the more specific logo filename used in the app assets
  const logoFilename = "Ohmni_Logo_RGB_Blue_WhiteBG.svg";

  return (
    <div className="App">
      <header className="App-header">
        <div className="logo-container">
          <img src={`/${logoFilename}`} alt="Ohmni Logo" />
        </div>

        <nav className="navigation">
          <NavLink to="/">Home</NavLink>
          <NavLink to="/operational-details">Operational Details</NavLink>
          <NavLink to="/engineering">Engineering</NavLink>
        </nav>

        <div className="header-right-side">
          <div className="status-time">{isClient ? formattedTime : 'Loading...'}</div>
          {token && (
            <button onClick={handleLogout} className="logout-button">Log Out</button>
          )}
        </div>
      </header>

      <main className="main-content">
        {/* Pass down locally managed state via Outlet context */}
        <Outlet context={{ setpoints, setSetpoints, user: auth.user }} />
      </main>
    </div>
  );
}

export default App;
</file>

<file path="src/index.css">
:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  display: flex;
  place-items: center;
  min-width: 320px;
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }
  button {
    background-color: #f9f9f9;
  }
}

.command-feedback {
  margin-top: 1rem;
  border-top: 2px solid #535bf2;
  font-weight: bold;
}
</file>

<file path="src/main.jsx">
import React from 'react';
import ReactDOM from 'react-dom/client';
import { createBrowserRouter, RouterProvider } from "react-router-dom";
import App from './App.jsx';
import './index.css';
import { AuthProvider } from './context/AuthContext';
import HomePage from './pages/HomePage';
import OperationalDetailsPage from './pages/OperationalDetailsPage';
import EngineeringPage from './pages/EngineeringPage';
import LoginPage from './pages/LoginPage';
import ProtectedRoute from './components/ProtectedRoute';

const router = createBrowserRouter([
  {
    path: "/",
    element: <App />,
    children: [
      { index: true, element: <HomePage /> },
      { path: "operational-details", element: <OperationalDetailsPage /> },
      { 
        path: "engineering", 
        // THIS IS THE FIX: The route itself is protected, but the Admin check
        // will now happen INSIDE the EngineeringPage component.
        element: (
          <ProtectedRoute>
            <EngineeringPage />
          </ProtectedRoute>
        )
      },
      { path: "login", element: <LoginPage /> },
    ],
  },
]);

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <AuthProvider>
      <RouterProvider router={router} />
    </AuthProvider>
  </React.StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/ohmni_pty_ltd_logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dashboard-ui</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "dashboard-ui",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.13.2",
    "chart.js": "^4.5.1",
    "chartjs-adapter-date-fns": "^3.0.0",
    "date-fns": "^4.1.0",
    "react": "^19.2.0",
    "react-chartjs-2": "^5.3.1",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.9.6"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.2",
    "@types/react-dom": "^19.2.2",
    "@vitejs/plugin-react": "^5.1.0",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.2"
  }
}
</file>

<file path="README.md">
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

</files>
